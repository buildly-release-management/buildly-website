<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Load the header system -->
    <script src="/js/buildly-head.js"></script>
    
    <!-- Page specific -->
    <title>Google Analytics Test - Buildly</title>
    <meta name="description" content="Test page to verify Google Analytics implementation">
    <meta name="robots" content="noindex, nofollow">
</head>
<body class="font-sans bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-buildly-primary mb-8">Google Analytics Implementation Test</h1>
        
        <div class="bg-white rounded-lg p-6 shadow-sm mb-6">
            <h2 class="text-2xl font-bold mb-4">Implementation Status</h2>
            <div id="analytics-status" class="space-y-4">
                <div class="flex items-center">
                    <span class="w-4 h-4 rounded-full mr-3" id="gtag-script-status"></span>
                    <span>Google Analytics Script (gtag.js)</span>
                    <span class="ml-auto" id="gtag-script-text">Checking...</span>
                </div>
                <div class="flex items-center">
                    <span class="w-4 h-4 rounded-full mr-3" id="gtag-function-status"></span>
                    <span>gtag() Function</span>
                    <span class="ml-auto" id="gtag-function-text">Checking...</span>
                </div>
                <div class="flex items-center">
                    <span class="w-4 h-4 rounded-full mr-3" id="datalayer-status"></span>
                    <span>dataLayer Array</span>
                    <span class="ml-auto" id="datalayer-text">Checking...</span>
                </div>
                <div class="flex items-center">
                    <span class="w-4 h-4 rounded-full mr-3" id="tracking-id-status"></span>
                    <span>Tracking ID (G-YFY5W80XQX)</span>
                    <span class="ml-auto" id="tracking-id-text">Checking...</span>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg p-6 shadow-sm mb-6">
            <h2 class="text-2xl font-bold mb-4">Test Event</h2>
            <p class="text-gray-600 mb-4">Click the button below to send a test event to Google Analytics:</p>
            <button onclick="sendTestEvent()" class="bg-buildly-primary text-white px-6 py-3 rounded-lg hover:bg-buildly-secondary transition-colors">
                Send Test Event
            </button>
            <div id="test-result" class="mt-4"></div>
        </div>

        <div class="bg-white rounded-lg p-6 shadow-sm">
            <h2 class="text-2xl font-bold mb-4">Implementation Details</h2>
            <div class="bg-gray-50 p-4 rounded">
                <pre id="implementation-details" class="text-sm"></pre>
            </div>
        </div>
    </div>

    <script>
        // Wait for page to fully load
        window.addEventListener('load', function() {
            setTimeout(checkAnalyticsImplementation, 1000);
        });

        function checkAnalyticsImplementation() {
            // Check for gtag script
            const gtagScripts = document.querySelectorAll('script[src*="googletagmanager.com/gtag/js"]');
            updateStatus('gtag-script', gtagScripts.length > 0, `Found ${gtagScripts.length} script(s)`);

            // Check for gtag function
            const hasGtag = typeof gtag === 'function';
            updateStatus('gtag-function', hasGtag, hasGtag ? 'Available' : 'Not found');

            // Check for dataLayer
            const hasDataLayer = typeof dataLayer !== 'undefined' && Array.isArray(dataLayer);
            updateStatus('datalayer', hasDataLayer, hasDataLayer ? `${dataLayer.length} items` : 'Not found');

            // Check for tracking ID
            const hasTrackingId = hasDataLayer && dataLayer.some(item => 
                item[1] === 'config' && item[2] === 'G-YFY5W80XQX'
            );
            updateStatus('tracking-id', hasTrackingId, hasTrackingId ? 'Configured' : 'Not configured');

            // Show implementation details
            showImplementationDetails();
        }

        function updateStatus(elementId, isSuccess, message) {
            const statusElement = document.getElementById(elementId + '-status');
            const textElement = document.getElementById(elementId + '-text');
            
            if (isSuccess) {
                statusElement.classList.add('bg-green-500');
                statusElement.classList.remove('bg-red-500', 'bg-yellow-500');
                textElement.textContent = '✓ ' + message;
                textElement.classList.add('text-green-600');
            } else {
                statusElement.classList.add('bg-red-500');
                statusElement.classList.remove('bg-green-500', 'bg-yellow-500');
                textElement.textContent = '✗ ' + message;
                textElement.classList.add('text-red-600');
            }
        }

        function sendTestEvent() {
            if (typeof gtag === 'function') {
                gtag('event', 'test_event', {
                    'event_category': 'engagement',
                    'event_label': 'analytics_test_page',
                    'value': 1
                });
                document.getElementById('test-result').innerHTML = 
                    '<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">✓ Test event sent successfully!</div>';
            } else {
                document.getElementById('test-result').innerHTML = 
                    '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">✗ gtag function not available</div>';
            }
        }

        function showImplementationDetails() {
            const details = document.getElementById('implementation-details');
            let info = 'Google Analytics Implementation Status:\n\n';
            
            info += `gtag function: ${typeof gtag}\n`;
            info += `dataLayer: ${typeof dataLayer} (${Array.isArray(dataLayer) ? dataLayer.length + ' items' : 'not array'})\n`;
            
            if (typeof dataLayer !== 'undefined' && Array.isArray(dataLayer)) {
                info += `\ndataLayer contents:\n`;
                dataLayer.forEach((item, index) => {
                    info += `  ${index}: ${JSON.stringify(item)}\n`;
                });
            }
            
            const gtagScripts = document.querySelectorAll('script[src*="googletagmanager.com"]');
            info += `\nGoogle Analytics scripts found: ${gtagScripts.length}\n`;
            gtagScripts.forEach((script, index) => {
                info += `  ${index + 1}: ${script.src}\n`;
            });
            
            details.textContent = info;
        }
    </script>
</body>
</html>
